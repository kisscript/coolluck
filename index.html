<!DOCTYPE html><html>
  <link rel="icon" href="favicon.png" type="image/png">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <style>
    canvas {left: 0; position: absolute; top: 0;}
  </style>
  <title>Coolluck</title>
<head>

</head><body><script>

var w = window;
var d = w.document;

var g =
{
  set a (a)
  {
    var x = g.c.x (b.x);
    var y = g.c.y (b.y);
    var w = g.c.x (b.w);
    var h = g.c.y (b.h);
    var r = g.c.xymin (b.r);
    var a = a;
        a.id = (a.id) ? a.id : g.animate.length;
        a.s = [];
        a.t = 0;
        a.tick = (a.tick) ? a.tick : a.time / a.step.length;
        a.time = (a.time) ? a.time : a.tick * a.step.length;
    g.animate[a.id] = a;
  },

  animate: [],

  set b (b)
  {
    var x = g.c.x (b.x);
    var y = g.c.y (b.y);
    var w = g.c.x (b.w);
    var h = g.c.y (b.h);
    var r = g.c.xymin (b.r);
    var b = b;
        b.actived = false;
        b.id = (b.id) ? b.id : 'b' + g.button.length;
        b.showed = false;

        b.i = b.id + b.i0.name;

        b.action = function ()
        {
          if (g.e.type == 'click')
          {
            var inzone = (b.r) ? g.c.inring (x, y, r) : g.c.inbox (x, y, w, h);
            if (inzone)
            {
              b.a ();
            };
          };
        };

        b.active = function ()
        {
          if (g.e.type == 'mousemove')
          {
            var inzone = (b.r) ? g.c.inring (x, y, r) : g.c.inbox (x, y, w, h);
            if (inzone)
            {
              if (!b.actived)
              {
                g.c.style.cursor = 'pointer';
                b.i = (b.r) ? b.id : b.id + b.i0.name;
                b.hide (b.i);
                b.show (b.i1);
                b.actived = true;
              };
            }
            else
            {
              if (b.actived)
              {
                g.c.style.cursor = 'default';
                b.i = (b.r) ? b.id : b.id + b.i1.name;
                b.hide (b.i);
                b.show (b.i0);
                b.actived = false;
              };
            };
          };
        };

        b.destroy = function ()
        {
          g.c.style.cursor = 'default';
          b.hide (b.id);
          b.hide (b.id + b.i0.name);
          b.hide (b.id + b.i1.name);
          delete g.button[b.id];
        };

        b.hide = function (id)
        {
            b.showed = false;
            delete g.scene[id];
        };

        b.show = function (i)
        {
          if (!b.showed)
          {
            var _ = (b.r) ? g.d = { x: b.x, y: b.y, r: b.r, f: b.f, c: i, id: b.id } : g.d = { x: b.x, y: b.y, h: b.h, w: b.w, i: i, id: b.id + i.name };
            b.showed = true;
          };
        };

        b.update = function ()
        {
          x = g.c.x (b.x);
          y = g.c.y (b.y);
          w = g.c.x (b.w);
          h = g.c.y (b.h);
          r = g.c.xymin (b.r);
          b.action ();
          b.active ();
        };

    b.show (b.i0);
    g.button[b.id] = b;
  },

  button: [],

  c: function ()
  {
    var c = w.d.createElement ('canvas');
        c.a = function ()
        {
          c.height = w.innerHeight;
          c.width = w.innerWidth;
        };

        c.c = c.getContext ('2d');

        c.inbox = function (x, y, w, h)
        {
          return ((g.e.x >= x) && (g.e.x <= x + w) && (g.e.y >= y) && (g.e.y <= y + h));
        };

        c.inring = function (x, y, r)
        {
          var l = Math.sqrt (Math.pow (g.e.x - x, 2) + Math.pow (g.e.y - y, 2));
          return (l <= r);
        };

        c.update = function ()
        {
          switch (g.e.type) {
            case 'resize':
              c.a ();
              break;
          }
        };

        c.x = function (x)
        {
          var x = (x <= 1) ? x * g.c.width : x;
          return x;
        };

        c.xymin = function (xy)
        {
          var xy = (xy <= 1) ? xy * Math.min (g.c.height, g.c.width) : xy;
          return xy;
        };

        c.y = function (y)
        {
          var y = (y <= 1) ? y * g.c.height : y;
          return y;
        };

        delete g['c'];

        g.c = c;
        c.a ();
        w.d.body.appendChild (g.c);
  },

  city: [],

  set d (c)
  {
    var c = c;
        /*
          c - color
          f - fill
          s - size
        */

        c.id = (c.id) ? c.id : g.scene.length;

        c.type = 'box'; // h w x y
        c.type = (c.i) ? 'image' : c.type; // i x y
        c.type = (c.a) ? 'line' : c.type; // a b x y
        c.type = (c.r) ? 'ring' : c.type; // r x y
        c.type = (c.t) ? 'text' : c.type; // t x y

        g.scene[c.id] = c;
  },

  draw: function ()
  {
    g.c.c.clearRect (0, 0, g.c.width, g.c.height);

    for (var id in g.scene)
    {
      var c = g.scene[id];

      var a = g.c.x (c.a);
      var b = g.c.y (c.b);

      var x = g.c.x (c.x);
      var y = g.c.y (c.y);

      var w = g.c.x (c.w);
      var h = g.c.y (c.h);

      var r = g.c.xymin (c.r);

      g.c.c.beginPath ();
      var _ = (c.f) ? g.c.c.fillStyle = c.c : g.c.c.strokeStyle = c.c;
      switch (c.type)
      {
        case 'box':
          var _ = (c.f) ? g.c.c.fillRect (x, y, w, h) : g.c.c.strokeRect (x, y, w, h);
          break;

        case 'image':
          var _ = (c.h) ? g.c.c.drawImage (c.i, x, y, w, h) : g.c.c.drawImage (c.i, x, y);
          break;

        case 'line':
          g.c.c.moveTo (a, b);
          g.c.c.lineTo (x, y);
          break;

        case 'ring':
          g.c.c.arc (x, y, r, 0, 2 * Math.PI);
          var _ = (c.f) ? g.c.c.fill () : g.c.c.stroke ();
          break;

        case 'text':
          g.c.c.font = (c.s) ? c.s + ' ' + g.s.font.family : g.s.font.size + ' ' + g.s.font.family;
          var _ = (c.f) ? g.c.c.fillText (c.t, x, y) : g.c.c.strokeText (c.t, x, y) ;
          break;
      }
    };
  },

  e: {},

  effect:
  {
    set circle (e)
    {
      var x = g.c.x (e.x);
      var y = g.c.y (e.y);
      var r = 1;
      var id = 'effect_circle';
      var R = Math.min (g.c.height * 2, g.c.width * 2);
      var steps = 40;

      var o = {};
          o.id = id;

          o.animate = function ()
          {
            if (g.e.type == 'tick')
            {
              r += R / steps;
              if (r < R)
              {
                delete g.scene[id];
                g.d = { x: x, y: y, r: r, c: e.c, f: true, id: id };
              }
              else
              {
                delete g.scene[id];
                delete g.o[id];
                e.next ();
              };
            };
          };

          o.update = function ()
          {
            o.animate ();
          };

      g.o[id] = o;
    }
  },

  event: function (event)
  {
    g.e = event;
    g.run ();
  },

  g:
  {
    set city (o)
    {
      o.id = (o.id) ? o.id : 'city' + g.o.length;

      o.ready = function ()
      {
        var ready = true;
        for (var id in g.city)
        {
          var c = g.city[id];

          var r0 = g.c.xymin (c.r);
          var x0 = g.c.x (c.x);
          var y0 = g.c.y (c.y);

          var r1 = g.c.xymin (o.r);
          var x1 = g.c.x (o.x);
          var y1 = g.c.y (o.y);

          var r = Math.sqrt (Math.pow (x1 - x0, 2) + Math.pow (y1 - y0, 2));
          if (r < r0 + r1 + g.s.city.between)
          {
            ready = false;
            break;
          };
        };
        return ready;
      };

      if (g.city != [])
      {
        var ready = false;
        while (!ready)
        {
          o.x = g.r (0.1, 0.9);
          o.y = g.r (0.1, 0.9);
          o.r = g.r (0.03, 0.05);
          g.log = 0;
          ready = o.ready ();
        };
      }
      else
      {
        o.x = g.r (0.1, 0.9);
        o.y = g.r (0.1, 0.9);
        o.r = g.r (0.03, 0.05);
      };


      var x = g.c.x (o.x);
      var y = g.c.y (o.y);
      var r = g.c.xymin (o.r);
      g.b =
      { f: true, x: x, y: y, r: r, i0: '#ccc', i1: '#ddd', id: o.id,
        a: function ()
        {
          g.log = o.id;
        }
      };

      o.update = function ()
      {
        //o.show ();
      };
      g.city[o.id] = o;
    }
  },

  i:
  {
    set l (list)
    {
      for (var id in list)
      {
        var i = new Image ();
            i.name = id;
            i.src = list[id];
        g.i[id] = i;
      };
    }
  },

  load: function ()
  {
    g.e = { type: 'preload' };

    g.c ();

    //window
    Object.defineProperty
    (
    	w,
    	'ontick',
    	{
    		set: function (f)
    		{
    			w.timer = w.setInterval
    			(
    				function ()
    				{
    					f ({ type: 'tick' });
    					g.s.time += g.s.tick;
    				},
    				g.s.tick
    			);
    		}
    	}
    );

    w.onclick = g.event;
    w.onload = g.event;
    w.onmousedown = g.event;
    w.onmousemove = g.event;
    w.onmouseup = g.event;
    w.onresize = g.event;
    w.ontick = g.event;
  },

  set log (text)
  {
    w.console.log (text);
  },

  o: [],

  r: function (min, max)
  {
    var r = (max) ? Math.random () * (max - min) + min : Math.random () * min;
    return r;
  },

  run: function ()
  {
    g.update ();
    g.draw ();
  },

  s:
  {
    city:
    {
      between: 10,
      n: 50
    },

    font:
    {
      family: 'Arial',
      size: '1em'
    },

    tick: 20,
    time: 0
  },

  scene: [],

  update: function ()
  {
    g.c.update ();
    for (var id in g.button) { g.button[id].update (); };
    for (var id in g.city) { g.city[id].update (); };
    for (var id in g.o) { g.o[id].update (); };
  }
};

g.load ();
g.run ();

g.i.l =
{
  logo: 'logo.svg',
  logo1: 'logo1.svg'
};

var x = (g.c.width/2 - 59/2) / g.c.width;
var y = (g.c.height/2 - 72/2) / g.c.height;
g.b =
{ x: x, y: y, h: 72, w: 59, i0: g.i.logo, i1: g.i.logo1, id: 'logo',
  a: function ()
  {
    var x = (g.c.width/2) / g.c.width;
    var y = (g.c.height/2) / g.c.height;
    g.log = 'click sprite';
    g.effect.circle = { x: x, y: y, c: '#bbb',
      next: function ()
      {
        for (var i = 0; i < g.s.city.n; i++) { g.g.city = { id: 'city' + i }; };
      }
    };
    g.button['logo'].destroy ();
  }
};

</script></body></html>
